## 1. æ·±æ‹·è´

### 1.1. JSONæ–¹æ³•

>  JSONæ–¹æ³•

ğŸ”¥ ç¼ºé™·

- è¿™ç§æ·±æ‹·è´çš„æ–¹å¼å…¶å®å¯¹äºå‡½æ•°ã€`Symbol`ç­‰æ˜¯æ— æ³•å¤„ç†çš„ï¼›
- å¹¶ä¸”å¦‚æœå­˜åœ¨å¯¹è±¡çš„å¾ªç¯å¼•ç”¨ï¼Œä¹Ÿä¼šæŠ¥é”™çš„ï¼›

```javascript
console.log(window.window === window)

const info = {
    name: "why",
    age: 18,
    friend: {
        name: "kobe"
    },
    running: function() {},
    [Symbol()]: "abc",
    // obj: info
}
// info.obj = info   æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨

const obj4 = JSON.parse(JSON.stringify(info))
info.friend.name = "curry"
console.log(obj4.friend.name)
console.log(obj4)


// kobe
// { name: 'why', age: 18, friend: { name: 'kobe' } }
```





### 1.2. æ·±æ‹·è´å‡½æ•°çš„åŸºæœ¬ä½¿ç”¨

```javascript
// éœ€æ±‚: åˆ¤æ–­ä¸€ä¸ªæ ‡è¯†ç¬¦æ˜¯å¦æ˜¯å¯¹è±¡ç±»å‹
function isObject(value) {
    const valueType = typeof value
    return (value !== null) && ( valueType === "object" || valueType === "function" )
}
// æˆ‘ä»¬ç‰¹å®šå½“ä¸º null æ—¶ä¸æ˜¯å¯¹è±¡

// æ·±æ‹·è´å‡½æ•°
function deepCopy(originValue) {
    // 1.å¦‚æœæ˜¯åŸå§‹ç±»å‹, ç›´æ¥è¿”å›
    if (!isObject(originValue)) {
        return originValue
    }

    // 2.å¦‚æœæ˜¯å¯¹è±¡ç±»å‹, æ‰éœ€è¦åˆ›å»ºå¯¹è±¡
    const newObj = {}
    for (const key in originValue) {
        newObj[key] = deepCopy(originValue[key]);
    }
    return newObj
}



const info = {
    name: "why",
    age: 18,
    friend: {
        name: "kobe",
        address: {
            name: "æ´›æ‰çŸ¶",
            detail: "æ–¯å¦æ™®æ–¯ä¸­å¿ƒ"
        }
    }
}

const newObj = deepCopy(info)
info.friend.address.name = "åŒ—äº¬å¸‚"
console.log(newObj.friend.address.name)
```





### 1.3. æ·±æ‹·è´å‡½æ•°çš„æ•°ç»„æ‹·è´

```javascript
// æ·±æ‹·è´å‡½æ•°
function deepCopy(originValue) {
    // 1.å¦‚æœæ˜¯åŸå§‹ç±»å‹, ç›´æ¥è¿”å›
    if (!isObject(originValue)) {
        return originValue
    }

    // 2.å¦‚æœæ˜¯å¯¹è±¡ç±»å‹, æ‰éœ€è¦åˆ›å»ºå¯¹è±¡, å¦‚æœæ˜¯æ•°ç»„ç±»å‹, å°±åˆ›å»ºæ•°ç»„ ğŸ”¥
    const newObj = Array.isArray(originValue) ? []: {}
    for (const key in originValue) {
        newObj[key] = deepCopy(originValue[key]);
    }
    return newObj
}


const books = [
    { name: "é»„é‡‘æ—¶ä»£", price: 28, desc: { intro: "è¿™æœ¬ä¹¦ä¸é”™", info: "è¿™æœ¬ä¹¦è®²äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ•…äº‹" } },
    { name: "ä½ ä¸çŸ¥é“JavaScript", price: 99 },
]


const newBooks = deepCopy(books)
console.log(newBooks)


// [
//   {
//     name: 'é»„é‡‘æ—¶ä»£',
//     price: 28,
//     desc: { intro: 'è¿™æœ¬ä¹¦ä¸é”™', info: 'è¿™æœ¬ä¹¦è®²äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ•…äº‹' }
//   },
//   { name: 'ä½ ä¸çŸ¥é“JavaScript', price: 99 }
// ]
```



### 1.4. æ·±æ‹·è´å‡½æ•°çš„å…¶å®ƒç±»å‹

```javascript
// å†™ä¸€ä¸ªæ·±æ‹·è´å‡½æ•°
function is_Object(originValue) {
  const myType = typeof originValue;
  return myType != null && (myType === "function" || myType === "object");
}

function deepCopy(originValue) {
  // 1. åˆ¤æ–­å€¼æ˜¯å¦ä¸º symbol ç±»å‹
  if (typeof originValue === "symbol") {
    return Symbol(originValue.description);
  }

  // 2. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºåŸå§‹ç±»å‹æˆ–è€…promise , åˆ™ç›´æ¥è¿”å›
  if (!is_Object(originValue) || originValue instanceof Promise) {
    return originValue;
  }

  // 3. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºsetç±»å‹
  if (originValue instanceof Set) {
    const newSet = new Set();
    for (const i of originValue) {
      newSet.add(i);
    }
    return newSet;
  }

  // 4. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºmapç±»å‹
  if (originValue instanceof Map) {
    const newMap = new Map();
    for (const [i, j] of originValue) {
      newMap.set(deepCopy(i, map), deepCopy(j, map));
    }
    return newMap;
  }

     // 5. å¤„ç†æ—¥æœŸå¯¹è±¡
    if (originValue instanceof Date) {
        return new Date(originValue.getTime());
    }

    // 6. å¤„ç†æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
    if (originValue instanceof RegExp) {
        return new RegExp(originValue);
    }
    
  // 7. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºfunctionç±»å‹ , åˆ™ä¸éœ€è¦æ·±æ‹·è´
  if (typeof originValue === "function") return originValue;

  // 8. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºæ•°ç»„æˆ–è€…å¯¹è±¡ç±»å‹
  const newObj = Array.isArray(originValue) ? [] : {};

  // (1) éå†æ™®é€šç±»å‹
  for (const i in originValue) {
    newObj[i] = deepCopy(originValue[i]);
  }

  // (2) éå†symbolç±»å‹
  const symbolKeys = Object.getOwnPropertySymbols(originValue);
  for (const i of symbolKeys) {
    newObj[Symbol(i.description)] = deepCopy(originValue[i]);
  }
  return newObj;
}






const set = new Set(["abc", "cba", "nba"]);
const first = new Map([
  [1, "one"],
  [2, "two"],
  [3, "three"],
]);
const s1 = Symbol("s1");
const s2 = Symbol("s2");
const info = {
  name: "why",
  age: 18,
  friend: {
    name: "kobe",
    address: {
      name: "æ´›æ‰çŸ¶",
      detail: "æ–¯å¦æ™®æ–¯ä¸­å¿ƒ",
    },
  },

  // 1.ç‰¹æ®Šç±»å‹: Set
  set: set,
  // 2.ç‰¹æ®Šç±»å‹: Map
  zap: first,
  // 3.ç‰¹æ€§ç±»å‹: function
  running: function () {
    console.log("running~");
  },

  // 4.å€¼çš„ç‰¹æ®Šç±»å‹: Symbol
  symbolKey: Symbol("abc"),

  // 5.keyæ˜¯symbolæ—¶
  [s1]: "aaaa",
  [s2]: "bbbb",
};

const newObj = deepCopy(info);
console.log(newObj);
```

![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683277013732-2e2e2ffc-bc06-4f16-a748-3f06aef4951d.png)



### 1.5. æ·±æ‹·è´å‡½æ•°çš„å¾ªç¯å¼•ç”¨

```javascript
function isObject(originValue) {
  const myType = typeof originValue;
  return myType != null && (myType === "function" || myType === "object");
}

function deepCopy(originValue, map = new WeakMap()) {
  // const map = new WeakMap()

  // 1.å¦‚æœå€¼æ˜¯Symbolçš„ç±»å‹
  if (typeof originValue === "symbol") {
      return Symbol(originValue.description)
  }

  // 2.å¦‚æœæ˜¯åŸå§‹ç±»å‹æˆ–è€…promise, ç›´æ¥è¿”å›
  if (!isObject(originValue) || originValue instanceof Promise) {
      return originValue
  }

  // 3.å¦‚æœæ˜¯setç±»å‹
  if (originValue instanceof Set) {
      const newSet = new Set()
      for (const setItem of originValue) {
          newSet.add(deepCopy(setItem))
      }
      return newSet
  }

  // 4. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºmapç±»å‹
  if (originValue instanceof Map) {
      const newMap = new Map();
      for (const [i, j] of originValue) {
          newMap.set(deepCopy(i, map), deepCopy(j, map));
      }
      return newMap;
  }
    
     // 5. å¤„ç†æ—¥æœŸå¯¹è±¡
    if (originValue instanceof Date) {
        return new Date(originValue.getTime());
    }

    // 6. å¤„ç†æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
    if (originValue instanceof RegExp) {
        return new RegExp(originValue);
    }

  // 7.å¦‚æœæ˜¯å‡½æ•°functionç±»å‹, ä¸éœ€è¦è¿›è¡Œæ·±æ‹·è´
  if (typeof originValue === "function") {
      return originValue
  }
    

  // 8.å¤„ç†å¾ªç¯å¼•ç”¨
  if (map.get(originValue)) {
      return map.get(originValue)
  }

  // 9.åˆ¤æ–­æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ç±»å‹
  const newObj = Array.isArray(originValue) ? []: {}
  map.set(originValue, newObj)

  // éå†æ™®é€šçš„key
  for (const key in originValue) {
      newObj[key] = deepCopy(originValue[key], map);
  }

  // å•ç‹¬éå†symbol
  const symbolKeys = Object.getOwnPropertySymbols(originValue)
  for (const symbolKey of symbolKeys) {
      newObj[Symbol(symbolKey.description)] = deepCopy(originValue[symbolKey], map)
  }

  return newObj
}

const set = new Set(["abc", "cba", "nba"]);
const first = new Map([
  [1, "one"],
  [2, "two"],
  [3, "three"],
]);
const s1 = Symbol("s1");
const s2 = Symbol("s2");
const info = {
  name: "why",
  age: 18,
  friend: {
    name: "kobe",
    address: {
      name: "æ´›æ‰çŸ¶",
      detail: "æ–¯å¦æ™®æ–¯ä¸­å¿ƒ",
    },
  },

  // 1.ç‰¹æ®Šç±»å‹: Set
  set: set,
  // 2.ç‰¹æ®Šç±»å‹: Map
  zap: first,
  // 3.ç‰¹æ€§ç±»å‹: function
  running: function () {
    console.log("running~");
  },

  // 4.å€¼çš„ç‰¹æ®Šç±»å‹: Symbol
  symbolKey: Symbol("abc"),

  // 5.keyæ˜¯symbolæ—¶
  [s1]: "aaaa",
  [s2]: "bbbb",
};

// 6. å¾ªç¯å¼•ç”¨
info.self = info

let newObj = deepCopy(info)
console.log(newObj)
console.log(newObj.self === newObj)
```

![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683378207496-0553ffb2-d2ee-4e05-b8b8-caa555b71aa6.png)



### 1.6. æ·±æ‹·è´å‡½æ•°æœ€ç»ˆå†™æ³• ğŸ”¥

```javascript
function isObject(originValue) {
    const myType = typeof originValue;
    return myType != null && (myType === "function" || myType === "object");
}

function deepCopy(originValue, map = new WeakMap()) {
    // const map = new WeakMap()

    // 1.å¦‚æœå€¼æ˜¯Symbolçš„ç±»å‹
    if (typeof originValue === "symbol") {
        return Symbol(originValue.description)
    }

    // 2.å¦‚æœæ˜¯åŸå§‹ç±»å‹æˆ–è€…promise, ç›´æ¥è¿”å›
    // å¦‚æœä½ æ·±æ‹·è´ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¯èƒ½ä¼šç ´åå…¶å¼‚æ­¥è¡Œä¸ºï¼Œå¹¶ä¸”å¯¼è‡´æ„å¤–è¡Œä¸ºã€‚
    // è¿™æ ·å¯ä»¥é¿å…ç ´åå¼‚æ­¥è¡Œä¸ºå’Œæ„å¤–è¡Œä¸ºã€‚
    if (!isObject(originValue) || originValue instanceof Promise) {
        return originValue
    }

    // 3.å¦‚æœæ˜¯setç±»å‹
    if (originValue instanceof Set) {
        const newSet = new Set()
        for (const setItem of originValue) {
            newSet.add(deepCopy(setItem))
        }
        return newSet
    }

    // 4. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºmapç±»å‹
    if (originValue instanceof Map) {
        const newMap = new Map();
        for (const [i, j] of originValue) {
            newMap.set(deepCopy(i, map), deepCopy(j, map));
        }
        return newMap;
    }

    // 5. å¤„ç†æ—¥æœŸå¯¹è±¡
    if (originValue instanceof Date) {
        return new Date(originValue.getTime());
    }

    // 6. å¤„ç†æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
    if (originValue instanceof RegExp) {
        return new RegExp(originValue);
    }

    // 7.å¦‚æœæ˜¯å‡½æ•°functionç±»å‹, ä¸éœ€è¦è¿›è¡Œæ·±æ‹·è´
    if (typeof originValue === "function") {
        return originValue
    }

    // 8.å¤„ç†å¾ªç¯å¼•ç”¨
    if (map.get(originValue)) {
        return map.get(originValue)
    }

    // 9.åˆ¤æ–­æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ç±»å‹
    const newObj = Array.isArray(originValue) ? []: {}
    map.set(originValue, newObj)

    // . å¤„ç†åŸå‹å±æ€§ (äº†è§£å³å¯, ä½†æ˜¯è¿™é‡Œmaybeäº§ç”ŸçŸ›ç›¾)
    // const prototype = Object.getPrototypeOf(originValue);
    // if (prototype !== null && prototype !== Object.prototype) {
    //     if (map.has(prototype)) {
    //         newObj.__proto__ = map.get(prototype);
    //     } else {
    //         const prototypeCopy = deepCopy(prototype, map);
    //         newObj.__proto__ = prototypeCopy;
    //         map.set(prototype, prototypeCopy);
    //     }
    // }


    // éå†æ™®é€šçš„key
    for (const key in originValue) {
        newObj[key] = deepCopy(originValue[key], map);
    }

    // å•ç‹¬éå†symbol
    const symbolKeys = Object.getOwnPropertySymbols(originValue)
    for (const symbolKey of symbolKeys) {
        newObj[Symbol(symbolKey.description)] = deepCopy(originValue[symbolKey], map)
    }

    return newObj
}
```



## 2. äº‹ä»¶æ€»çº¿  (äº†è§£)

 äº†è§£, æˆ–è€…çœ‹è¯¾ç¨‹å›é¡¾

### 2.1. è‡ªå®šä¹‰äº‹ä»¶æ€»çº¿



![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683378455223-e96faa76-e436-440d-a32f-e14ca41fabb3.png)



```javascript
 // ç±»EventBus -> äº‹ä»¶æ€»çº¿å¯¹è±¡
    class HYEventBus {
      constructor() {
        this.eventMap = {}
      } 

      on(eventName, eventFn) {
        let eventFns = this.eventMap[eventName]
        if (!eventFns) {
          eventFns = []
          this.eventMap[eventName] = eventFns
        }
        eventFns.push(eventFn)
      }
      
      off(eventName, eventFn) {
        let eventFns = this.eventMap[eventName]
        if (!eventFns) return
        for (let i = 0; i < eventFns.length; i++) {
          const fn = eventFns[i]
          if (fn === eventFn) {
            eventFns.splice(i, 1)
            break
          }
        }

        // å¦‚æœeventFnså·²ç»æ¸…ç©ºäº†
        if (eventFns.length === 0) {
          delete this.eventMap[eventName]
        }
      }

      emit(eventName, ...args) {
        let eventFns = this.eventMap[eventName]
        if (!eventFns) return
        eventFns.forEach(fn => {
          fn(...args)
        })
      }
    }


    // ä½¿ç”¨è¿‡ç¨‹
    const eventBus = new HYEventBus()

    // aside.vueç»„ä»¶ä¸­ç›‘å¬äº‹ä»¶
    eventBus.on("navclick", (name, age, height) => {
      console.log("navclick listener 01", name, age, height)
    })

    const click =  () => {
      console.log("navclick listener 02")
    }
    eventBus.on("navclick", click)

    setTimeout(() => {
      eventBus.off("navclick", click)
    }, 5000);

    eventBus.on("asideclick", () => {
      console.log("asideclick listener")
    })


    // nav.vue
    const navBtnEl = document.querySelector(".nav-btn")
    navBtnEl.onclick = function() {
      console.log("è‡ªå·±ç›‘å¬åˆ°")
      eventBus.emit("navclick", "why", 18, 1.88)
    }
```