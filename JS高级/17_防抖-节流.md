å¯¹äºæŸäº›é¢‘ç¹çš„äº‹ä»¶å¤„ç†ä¼šé€ æˆæ€§èƒ½çš„æŸè€—ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é˜²æŠ–å’ŒèŠ‚æµæ¥é™åˆ¶äº‹ä»¶é¢‘ç¹çš„å‘ç”Ÿ . 





## 1. è®¤è¯†é˜²æŠ–

ç±»ä¼¼å›åŸ, è¦æ˜¯ä¸­é€”æ‰“æ–­, åˆ™é‡æ–°è®°æ—¶.  ğŸ”¥ğŸ”¥ğŸ”¥

- ï° å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œç›¸åº”çš„å‡½æ•°å¹¶ä¸ä¼šç«‹å³è§¦å‘ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼›
- ï° å½“äº‹ä»¶å¯†é›†è§¦å‘æ—¶ï¼Œå‡½æ•°çš„è§¦å‘ä¼šè¢«é¢‘ç¹çš„æ¨è¿Ÿï¼›
- ï° åªæœ‰ç­‰å¾…äº†ä¸€æ®µæ—¶é—´ä¹Ÿæ²¡æœ‰äº‹ä»¶è§¦å‘ï¼Œæ‰ä¼šçœŸæ­£çš„æ‰§è¡Œå“åº”å‡½æ•°ï¼›



åº”ç”¨åœºæ™¯

- è¾“å…¥æ¡†ä¸­é¢‘ç¹çš„è¾“å…¥å†…å®¹ï¼Œæœç´¢æˆ–è€…æäº¤ä¿¡æ¯ï¼›
- é¢‘ç¹çš„ç‚¹å‡»æŒ‰é’®ï¼Œè§¦å‘æŸä¸ªäº‹ä»¶ï¼›
- ç›‘å¬æµè§ˆå™¨æ»šåŠ¨äº‹ä»¶ï¼Œå®ŒæˆæŸäº›ç‰¹å®šæ“ä½œï¼›
- ç”¨æˆ·ç¼©æ”¾æµè§ˆå™¨çš„`resize`äº‹ä»¶ï¼›



ä½¿ç”¨underscoreè¿›è¡Œé˜²æŠ–æ“ä½œ

![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683273530824-268969b3-5eea-4f1d-9027-5c108701e50b.png)





## 2. å®ç°é˜²æŠ–



### 2.1. åŸºæœ¬å®ç° -- (é¢è¯•)

```javascript
function hydebounce(fn, delay) {
    // 1.ç”¨äºè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶è§¦å‘çš„timer
    let timer = null

    // 2.è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œçš„å‡½æ•°
    const _debounce = () => {
        // 2.1.å¦‚æœæœ‰å†æ¬¡è§¦å‘(æ›´å¤šæ¬¡è§¦å‘)äº‹ä»¶, é‚£ä¹ˆå–æ¶ˆä¸Šä¸€æ¬¡çš„äº‹ä»¶
        if (timer) clearTimeout(timer)

        // 2.2.å»¶è¿Ÿå»æ‰§è¡Œå¯¹åº”çš„fnå‡½æ•°(ä¼ å…¥çš„å›è°ƒå‡½æ•°)
        timer = setTimeout(() => {
            fn()
            timer = null // æ‰§è¡Œè¿‡å‡½æ•°ä¹‹å, å°†timeré‡æ–°ç½®null
        }, delay);
    }

    // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
    return _debounce
}

const inputEl = document.querySelector("input")
let counter = 1
inputEl.oninput = hydebounce(function() {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}`)
}, 1000)
```





### 2.2. `this`å’Œå‚æ•°ç»‘å®š

```javascript
function hydebounce(fn, delay) {
    // 1.ç”¨äºè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶è§¦å‘çš„timer
    let timer = null

    // 2.è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œçš„å‡½æ•°
    const _debounce = function(...args) {
        // 2.1.å¦‚æœæœ‰å†æ¬¡è§¦å‘(æ›´å¤šæ¬¡è§¦å‘)äº‹ä»¶, é‚£ä¹ˆå–æ¶ˆä¸Šä¸€æ¬¡çš„äº‹ä»¶
        if (timer) clearTimeout(timer)

        // 2.2.å»¶è¿Ÿå»æ‰§è¡Œå¯¹åº”çš„fnå‡½æ•°(ä¼ å…¥çš„å›è°ƒå‡½æ•°)
        timer = setTimeout(() => {
            fn.apply(this, args)
            timer = null // æ‰§è¡Œè¿‡å‡½æ•°ä¹‹å, å°†timeré‡æ–°ç½®null
        }, delay);
    }

    // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
    return _debounce
}

const inputEl = document.querySelector("input")
let counter = 1
inputEl.oninput = hydebounce(function() {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}`)
}, 1000)
```



### 2.3. å–æ¶ˆåŠŸèƒ½å®ç°

```javascript
function hydebounce(fn, delay) {
    // 1.ç”¨äºè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶è§¦å‘çš„timer
    let timer = null

    // 2.è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œçš„å‡½æ•°
    const _debounce = function(...args) {
        // 2.1.å¦‚æœæœ‰å†æ¬¡è§¦å‘(æ›´å¤šæ¬¡è§¦å‘)äº‹ä»¶, é‚£ä¹ˆå–æ¶ˆä¸Šä¸€æ¬¡çš„äº‹ä»¶
        if (timer) clearTimeout(timer)

        // 2.2.å»¶è¿Ÿå»æ‰§è¡Œå¯¹åº”çš„fnå‡½æ•°(ä¼ å…¥çš„å›è°ƒå‡½æ•°)
        timer = setTimeout(() => {
            fn.apply(this, args)
            timer = null // æ‰§è¡Œè¿‡å‡½æ•°ä¹‹å, å°†timeré‡æ–°ç½®null
        }, delay);
    }

    // 3.ç»™_debounceç»‘å®šä¸€ä¸ªå–æ¶ˆçš„å‡½æ•°
    _debounce.cancel = function() {
        if (timer) clearTimeout(timer)
    }

    // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
    return _debounce
}



// 1.è·å–inputå…ƒç´ 
const inputEl = document.querySelector("input")
const cancelBtn = document.querySelector(".cancel")

// 2.è‡ªå·±å®ç°çš„é˜²æŠ–
let counter = 1
const debounceFn = hydebounce(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this, event)
}, 5000)
inputEl.oninput = debounceFn

// 3.å®ç°å–æ¶ˆçš„åŠŸèƒ½
cancelBtn.onclick = function() {
    debounceFn.cancel()
}
```





### 2.4. ç«‹å³æ‰§è¡ŒåŠŸèƒ½

```javascript
// åŸåˆ™: ä¸€ä¸ªå‡½æ•°è¿›è¡Œåšä¸€ä»¶äº‹æƒ…, ä¸€ä¸ªå˜é‡ä¹Ÿç”¨äºè®°å½•ä¸€ç§çŠ¶æ€

function hydebounce(fn, delay, immediate = false) {  // é»˜è®¤ä¸ç«‹å³æ‰§è¡Œ
    // 1.ç”¨äºè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶è§¦å‘çš„timer
    let timer = null
    let isInvoke = false

    // 2.è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œçš„å‡½æ•°
    const _debounce = function(...args) {
        // 2.1.å¦‚æœæœ‰å†æ¬¡è§¦å‘(æ›´å¤šæ¬¡è§¦å‘)äº‹ä»¶, é‚£ä¹ˆå–æ¶ˆä¸Šä¸€æ¬¡çš„äº‹ä»¶
        if (timer) clearTimeout(timer)

        // ç¬¬ä¸€æ¬¡æ“ä½œæ˜¯ä¸éœ€è¦å»¶è¿Ÿ
        if (immediate && !isInvoke) {  
            fn.apply(this, args)
            isInvoke = true   
            return
        }

        // 2.2.å»¶è¿Ÿå»æ‰§è¡Œå¯¹åº”çš„fnå‡½æ•°(ä¼ å…¥çš„å›è°ƒå‡½æ•°)
        timer = setTimeout(() => {
            fn.apply(this, args)
            timer = null // æ‰§è¡Œè¿‡å‡½æ•°ä¹‹å, å°†timeré‡æ–°ç½®null
            isInvoke = false
        }, delay);
    }

    // 3.ç»™_debounceç»‘å®šä¸€ä¸ªå–æ¶ˆçš„å‡½æ•°
    _debounce.cancel = function() {
        if (timer) clearTimeout(timer)
        timer = null
        isInvoke = false
    }

    // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
    return _debounce
}

// 1.è·å–inputå…ƒç´ 
const inputEl = document.querySelector("input")
const cancelBtn = document.querySelector(".cancel")

// 2.è‡ªå·±å®ç°çš„é˜²æŠ–
let counter = 1
const debounceFn = hydebounce(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this, event)
}, 5000,true)
inputEl.oninput = debounceFn

// 3.å®ç°å–æ¶ˆçš„åŠŸèƒ½
cancelBtn.onclick = function() {
    debounceFn.cancel()
}
```

åœ¨ç»™å®šçš„å‡½æ•°hydebounceä¸­ï¼Œ**isInvokeå˜é‡**ç”¨äºè·Ÿè¸ªæ˜¯å¦å·²ç»è§¦å‘äº†ä¸€æ¬¡å‡½æ•°æ‰§è¡Œã€‚

ä½œç”¨å¦‚ä¸‹ï¼š

å½“immediateå‚æ•°ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºå¸Œæœ›ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚æ­¤æ—¶ï¼Œå¦‚æœisInvokeä¸ºfalseï¼Œè¯´æ˜å‡½æ•°å°šæœªè¢«è§¦å‘è¿‡ï¼Œé‚£ä¹ˆç«‹å³æ‰§è¡Œä¼ å…¥çš„å‡½æ•°fnï¼Œå¹¶å°†isInvokeæ ‡è®°ä¸ºtrueï¼Œè¡¨ç¤ºå‡½æ•°å·²ç»è¢«è§¦å‘è¿‡ã€‚

å¦‚æœimmediateå‚æ•°ä¸ºfalseï¼Œåˆ™åœ¨æ­£å¸¸çš„å»¶è¿Ÿæ‰§è¡Œæƒ…å†µä¸‹ï¼ŒisInvokeæ²¡æœ‰ç‰¹æ®Šä½œç”¨ï¼Œåªæ˜¯ç”¨æ¥è·Ÿè¸ªå‡½æ•°æ˜¯å¦è¢«è§¦å‘è¿‡ã€‚æ¯å½“å‡½æ•°æ‰§è¡Œåï¼Œä¼šå°†isInvokeé‡ç½®ä¸ºfalseï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡å‡½æ•°è¢«è§¦å‘æ—¶å¯ä»¥å†æ¬¡æ‰§è¡Œã€‚

æ€»ç»“æ¥è¯´ï¼ŒisInvokeå˜é‡ç”¨äºè·Ÿè¸ªå‡½æ•°æ˜¯å¦å·²ç»è¢«è§¦å‘è¿‡ï¼Œç‰¹åˆ«æ˜¯åœ¨ç«‹å³æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä»¥é¿å…å¤šæ¬¡è§¦å‘ã€‚



### 2.5. è·å–è¿”å›å€¼

ä»…ä»…åªæ˜¯æ‹¿åˆ°è¿”å›å€¼

```javascript
function hydebounce(fn, delay, immediate = false, resultCallback) {
    // 1.ç”¨äºè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶è§¦å‘çš„timer
    let timer = null
    let isInvoke = false

    // 2.è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œçš„å‡½æ•°
    const _debounce = function(...args) {
        return new Promise((resolve, reject) => {
            try {
                // 2.1.å¦‚æœæœ‰å†æ¬¡è§¦å‘(æ›´å¤šæ¬¡è§¦å‘)äº‹ä»¶, é‚£ä¹ˆå–æ¶ˆä¸Šä¸€æ¬¡çš„äº‹ä»¶
                if (timer) clearTimeout(timer)

                // ç¬¬ä¸€æ¬¡æ“ä½œæ˜¯ä¸éœ€è¦å»¶è¿Ÿ
                let res = undefined
                if (immediate && !isInvoke) {
                    res = fn.apply(this, args)
                    if (resultCallback) resultCallback(res)
                    resolve(res)
                    isInvoke = true
                    return
                }

                // 2.2.å»¶è¿Ÿå»æ‰§è¡Œå¯¹åº”çš„fnå‡½æ•°(ä¼ å…¥çš„å›è°ƒå‡½æ•°)
                timer = setTimeout(() => {
                    res = fn.apply(this, args)
                    if (resultCallback) resultCallback(res)
                    resolve(res)
                    timer = null // æ‰§è¡Œè¿‡å‡½æ•°ä¹‹å, å°†timeré‡æ–°ç½®null
                    isInvoke = false
                }, delay);
            } catch (error) {
                reject(error)
            }
        })
    }

    // 3.ç»™_debounceç»‘å®šä¸€ä¸ªå–æ¶ˆçš„å‡½æ•°
    _debounce.cancel = function() {
        if (timer) clearTimeout(timer)
        timer = null
        isInvoke = false
    }

    // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
    return _debounce



    // 1.è·å–inputå…ƒç´ 
    const inputEl = document.querySelector("input")
    const cancelBtn = document.querySelector(".cancel")

    // 2.æ‰‹åŠ¨ç»‘å®šå‡½æ•°å’Œæ‰§è¡Œ
    const myDebounceFn = hydebounce(function(name, age, height) {
        console.log("----------", name, age, height)
        return "coderwhy å“ˆå“ˆå“ˆå“ˆ"   // è¿™ä¸ªå°±æ˜¯thençš„å‚æ•°
    }, 3000, true)
    inputEl.oninput = myDebounceFn;
    myDebounceFn("why", 18, 1.88).then(res => {  // æ‰§è¡Œ
        console.log("æ‹¿åˆ°æ‰§è¡Œç»“æœ:", res)
    })
```



### 2.6. å°è£…ç‹¬ç«‹æ–‡ä»¶

é˜²æŠ–å‡½æ•°

```javascript
// åŸåˆ™: ä¸€ä¸ªå‡½æ•°è¿›è¡Œåšä¸€ä»¶äº‹æƒ…, ä¸€ä¸ªå˜é‡ä¹Ÿç”¨äºè®°å½•ä¸€ç§çŠ¶æ€
function hydebounce(fn, delay, immediate = false, resultCallback) {
    // 1.ç”¨äºè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶è§¦å‘çš„timer
    let timer = null;
    let isInvoke = false;

    // 2.è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œçš„å‡½æ•°
    const _debounce = function (...args) {
        return new Promise((resolve, reject) => {
            try {
                // 2.1.å¦‚æœæœ‰å†æ¬¡è§¦å‘(æ›´å¤šæ¬¡è§¦å‘)äº‹ä»¶, é‚£ä¹ˆå–æ¶ˆä¸Šä¸€æ¬¡çš„äº‹ä»¶
                if (timer) clearTimeout(timer);

                // ç¬¬ä¸€æ¬¡æ“ä½œæ˜¯ä¸éœ€è¦å»¶è¿Ÿ
                let res = undefined;
                if (immediate && !isInvoke) {
                    res = fn.apply(this, args);
                    if (resultCallback) resultCallback(res);
                    resolve(res);
                    isInvoke = true;
                    return;
                }

                // 2.2.å»¶è¿Ÿå»æ‰§è¡Œå¯¹åº”çš„fnå‡½æ•°(ä¼ å…¥çš„å›è°ƒå‡½æ•°)
                timer = setTimeout(() => {
                    res = fn.apply(this, args);
                    if (resultCallback) resultCallback(res);
                    resolve(res);
                    timer = null; // æ‰§è¡Œè¿‡å‡½æ•°ä¹‹å, å°†timeré‡æ–°ç½®null
                    isInvoke = false;
                }, delay);
            } catch (error) {
                reject(error);
            }
        });
    };

    // 3.ç»™_debounceç»‘å®šä¸€ä¸ªå–æ¶ˆçš„å‡½æ•°
    _debounce.cancel = function () {
        if (timer) clearTimeout(timer);
        timer = null;
        isInvoke = false;
    };

    // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
    return _debounce;
}
```

æ³¨é‡Šç‰ˆ

```javascript
// å®šä¹‰é˜²æŠ–å‡½æ•°
function hydebounce(fn, delay, immediate = false, resultCallback) {
    let timer = null;  // è®°å½•å½“å‰çš„å®šæ—¶å™¨
    let isInvoke = false;  // è®°å½•å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨è¿‡

    // è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°ä¼šåœ¨äº‹ä»¶è§¦å‘å delay æ¯«ç§’æ‰§è¡Œå‡½æ•° fnï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…åˆè§¦å‘äº†ç›¸åŒçš„äº‹ä»¶ï¼Œåˆ™é‡æ–°è®¡æ—¶
    const _debounce = function (...args) {
        // è¿”å›ä¸€ä¸ª Promiseï¼Œä»¥ä¾¿äºå¤„ç†å¼‚æ­¥æ“ä½œ
        return new Promise((resolve, reject) => {
            try {
                // å¦‚æœæœ‰å®šæ—¶å™¨å­˜åœ¨ï¼Œè¯´æ˜åœ¨ delay æ—¶é—´å†…åˆè§¦å‘äº†äº‹ä»¶ï¼Œæ‰€ä»¥æ¸…é™¤å®šæ—¶å™¨ï¼Œé‡æ–°å¼€å§‹è®¡æ—¶
                if (timer) clearTimeout(timer);

                let res = undefined;
                // å¦‚æœ immediate ä¸º true å¹¶ä¸”å‡½æ•°å°šæœªè¢«è°ƒç”¨è¿‡ï¼Œé‚£ä¹ˆç«‹å³æ‰§è¡Œå‡½æ•° fn
                if (immediate && !isInvoke) {
                    res = fn.apply(this, args);  // æ‰§è¡Œå‡½æ•° fn å¹¶è·å–è¿”å›å€¼
                    if (resultCallback) resultCallback(res);  // å¦‚æœå­˜åœ¨å›è°ƒå‡½æ•°ï¼Œåˆ™æ‰§è¡Œå›è°ƒå‡½æ•°
                    resolve(res);  // å°†å‡½æ•° fn çš„è¿”å›å€¼ä¼ ç»™ Promise
                    isInvoke = true;  // æ›´æ–°å‡½æ•°è°ƒç”¨çŠ¶æ€
                    return;
                }

                // åœ¨ delay æ¯«ç§’åæ‰§è¡Œå‡½æ•° fn
                timer = setTimeout(() => {
                    res = fn.apply(this, args);  // æ‰§è¡Œå‡½æ•° fn å¹¶è·å–è¿”å›å€¼
                    if (resultCallback) resultCallback(res);  // å¦‚æœå­˜åœ¨å›è°ƒå‡½æ•°ï¼Œåˆ™æ‰§è¡Œå›è°ƒå‡½æ•°
                    resolve(res);  // å°†å‡½æ•° fn çš„è¿”å›å€¼ä¼ ç»™ Promise
                    timer = null;  // æ¸…é™¤å®šæ—¶å™¨
                    isInvoke = false;  // æ›´æ–°å‡½æ•°è°ƒç”¨çŠ¶æ€
                }, delay);
            } catch (error) {
                reject(error);  // å¦‚æœå‡ºç°é”™è¯¯ï¼Œå°†é”™è¯¯ä¼ ç»™ Promise
            }
        });
    };

    // æ·»åŠ ä¸€ä¸ª cancel æ–¹æ³•ï¼Œç”¨äºå–æ¶ˆé˜²æŠ–
    _debounce.cancel = function () {
        if (timer) clearTimeout(timer);  // æ¸…é™¤å®šæ—¶å™¨
        timer = null;  // æ¸…é™¤å®šæ—¶å™¨
        isInvoke = false;  // æ›´æ–°å‡½æ•°è°ƒç”¨çŠ¶æ€
    };

    // è¿”å›æ–°å‡½æ•°
    return _debounce;
}
```

![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683274556671-a6002d7b-f190-457b-b112-e40028be2162.png)



## 3. è®¤è¯†èŠ‚æµ

ç±»ä¼¼å¹³A, ä¸€æ®µå›ºå®šæ—¶é—´å†…åªèƒ½æ‰§è¡Œä¸€æ¬¡, è¦æ˜¯ä¸­é€”å†æ¬¡æ“ä½œä¹Ÿä¸æ‰§è¡Œ  ğŸ”¥ğŸ”¥ğŸ”¥



- ï° å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªäº‹ä»¶çš„å“åº”å‡½æ•°ï¼›
- ï° å¦‚æœè¿™ä¸ªäº‹ä»¶ä¼šè¢«é¢‘ç¹è§¦å‘ï¼Œé‚£ä¹ˆèŠ‚æµå‡½æ•°ä¼šæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡æ¥æ‰§è¡Œå‡½æ•°ï¼›
- ï° ä¸ç®¡åœ¨è¿™ä¸ªä¸­é—´æœ‰å¤šå°‘æ¬¡è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œæ‰§è¡Œå‡½æ•°çš„é¢‘ç¹æ€»æ˜¯å›ºå®šçš„ï¼›



åº”ç”¨åœºæ™¯

- ç›‘å¬é¡µé¢çš„æ»šåŠ¨äº‹ä»¶ï¼›
- é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼›
- ç”¨æˆ·é¢‘ç¹ç‚¹å‡»æŒ‰é’®æ“ä½œï¼›
- æ¸¸æˆä¸­çš„ä¸€äº›è®¾è®¡ (å¹³a / æŠ€èƒ½é‡Šæ”¾)



ä½¿ç”¨underscoreè¿›è¡ŒèŠ‚æµæ“ä½œ

![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683274713761-26f2177e-fde4-44b3-a7d9-e9395582f3a3.png)





## 4. å®ç°èŠ‚æµ

 

### 4.1. åŸºæœ¬å®ç° -- (é¢è¯•)

```javascript
function hythrottle(fn, interval) {
    let startTime = 0

    const _throttle = function() {
        const nowTime = new Date().getTime()
        const waitTime = interval - (nowTime - startTime)  // ç¬¬ä¸€æ¬¡ä¸ºè´Ÿæ•°
        if (waitTime <= 0) {
            fn()
            startTime = nowTime
        }
    }

    return _throttle
}


const inputEl = document.querySelector("input")
let counter = 1
inputEl.oninput = hythrottle(function() {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this.value)
}, 1000)
```







### 4.2. `this`å’Œå‚æ•°ç»‘å®š

```javascript
function hythrottle(fn, interval) {
    let startTime = 0

    const _throttle = function(...args) {
        const nowTime = new Date().getTime()
        const waitTime = interval - (nowTime - startTime)
        if (waitTime <= 0) {
            fn.apply(this, args)
            startTime = nowTime
        }
    }

    return _throttle
}


const inputEl = document.querySelector("input")
let counter = 1
inputEl.oninput = hythrottle(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`,  this, event)
}, 1000)
```





### 4.3. ç«‹å³æ‰§è¡Œæ§åˆ¶

```javascript
function hythrottle(fn, interval, leading = true) {
    let startTime = 0

    const _throttle = function(...args) {
        // 1.è·å–å½“å‰æ—¶é—´
        const nowTime = new Date().getTime()

        // å¯¹ç«‹å³æ‰§è¡Œè¿›è¡Œæ§åˆ¶
        if (!leading && startTime === 0) {  // å–æ¶ˆç«‹å³æ‰§è¡Œ
            startTime = nowTime
        }

        // 2.è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´æ‰§è¡Œå‡½æ•°
        const waitTime = interval - (nowTime - startTime)
        if (waitTime <= 0) {
            fn.apply(this, args)
            startTime = nowTime
        }
    }

    return _throttle
}

const inputEl = document.querySelector("input")
let counter = 1
inputEl.oninput = hythrottle(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this.value, event)
}, 1000, false)
```





### 4.4. å°¾éƒ¨æ‰§è¡Œæ§åˆ¶ (äº†è§£)

å½“åœæ­¢æœ€åä¸€æ¬¡æ“ä½œæ—¶ , è¿™ä¸ªæ—¶å€™è¦æ˜¯æ—¶é—´è¿˜æ²¡åˆ°, ä½†æ˜¯è¿˜æ˜¯æ‰§è¡Œä¸€æ¬¡

```javascript
function hythrottle(fn, interval, { leading = true, trailing = false } = {}) {
    let startTime = 0
    let timer = null

    const _throttle = function(...args) {
        // 1.è·å–å½“å‰æ—¶é—´
        const nowTime = new Date().getTime()

        // å¯¹ç«‹å³æ‰§è¡Œè¿›è¡Œæ§åˆ¶
        if (!leading && startTime === 0) {
            startTime = nowTime
        }

        // 2.è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´æ‰§è¡Œå‡½æ•°
        const waitTime = interval - (nowTime - startTime)
        if (waitTime <= 0) {
            // console.log("æ‰§è¡Œæ“ä½œfn")
            if (timer) clearTimeout(timer)
            fn.apply(this, args)
            startTime = nowTime
            timer = null
            return
        } 

        // 3.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œå°¾éƒ¨
        if (trailing && !timer) {  
            timer = setTimeout(() => {
                // console.log("æ‰§è¡Œtimer")
                fn.apply(this, args)
                startTime = new Date().getTime()
                timer = null
            }, waitTime);
        }
    }

    return _throttle
}



const inputEl = document.querySelector("input")
let counter = 1
inputEl.oninput = hythrottle(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this.value, event)
}, 3000, { trailing: true })
```





### 4.5. å–æ¶ˆåŠŸèƒ½å®ç°

```javascript
function hythrottle(fn, interval, { leading = true, trailing = false } = {}) {
    let startTime = 0
    let timer = null

    const _throttle = function(...args) {
        // 1.è·å–å½“å‰æ—¶é—´
        const nowTime = new Date().getTime()

        // å¯¹ç«‹å³æ‰§è¡Œè¿›è¡Œæ§åˆ¶
        if (!leading && startTime === 0) {
            startTime = nowTime
        }

        // 2.è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´æ‰§è¡Œå‡½æ•°
        const waitTime = interval - (nowTime - startTime)
        if (waitTime <= 0) {
            // console.log("æ‰§è¡Œæ“ä½œfn")
            if (timer) clearTimeout(timer)
            fn.apply(this, args)
            startTime = nowTime
            timer = null
            return
        } 

        // 3.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œå°¾éƒ¨
        if (trailing && !timer) {
            timer = setTimeout(() => {
                // console.log("æ‰§è¡Œtimer")
                fn.apply(this, args)
                startTime = new Date().getTime()
                timer = null
            }, waitTime);
        }
    }

    _throttle.cancel = function() {
        if (timer) clearTimeout(timer)
        startTime = 0
        timer = null
    }

    return _throttle
}



const inputEl = document.querySelector("input")
const cancelBtn = document.querySelector(".cancel")

let counter = 1
const throttleFn = hythrottle(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this.value, event)
}, 3000, { trailing: true })

inputEl.oninput = throttleFn

cancelBtn.onclick = function() {
    throttleFn.cancel()
}
```



### 4.6. è·å–è¿”å›å€¼

```javascript
function hythrottle(fn, interval, { leading = true, trailing = false } = {}) {
    let startTime = 0
    let timer = null

    const _throttle = function(...args) {
        return new Promise((resolve, reject) => {
            try {
                // 1.è·å–å½“å‰æ—¶é—´
                const nowTime = new Date().getTime()

                // å¯¹ç«‹å³æ‰§è¡Œè¿›è¡Œæ§åˆ¶
                if (!leading && startTime === 0) {
                    startTime = nowTime
                }

                // 2.è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´æ‰§è¡Œå‡½æ•°
                const waitTime = interval - (nowTime - startTime)
                if (waitTime <= 0) {
                    // console.log("æ‰§è¡Œæ“ä½œfn")
                    if (timer) clearTimeout(timer)
                    const res = fn.apply(this, args)
                    resolve(res)
                    startTime = nowTime
                    timer = null
                    return
                } 

                // 3.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œå°¾éƒ¨
                if (trailing && !timer) {
                    timer = setTimeout(() => {
                        // console.log("æ‰§è¡Œtimer")
                        const res = fn.apply(this, args)
                        resolve(res)
                        startTime = new Date().getTime()
                        timer = null
                    }, waitTime);
                }
            } catch (error) {
                reject(error)
            }
        })
    }

    _throttle.cancel = function() {
        if (timer) clearTimeout(timer)
        startTime = 0
        timer = null
    }

    return _throttle
}



const inputEl = document.querySelector("input")
const cancelBtn = document.querySelector(".cancel")

let counter = 1

const throttleFn = hythrottle(function(event) {
    console.log(`å‘é€ç½‘ç»œè¯·æ±‚${counter++}:`, this.value, event)
    return "throttle return value"
}, 3000, { trailing: true })

throttleFn("aaaa").then(res => {
    console.log("res:", res)
})
inputEl.oninput = throttleFn;
```







### 4.7. å°è£…ç‹¬ç«‹æ–‡ä»¶

èŠ‚æµå‡½æ•°

```javascript
function hythrottle(fn, interval, { leading = true, trailing = false } = {}) {
    let startTime = 0;
    let timer = null;

    const _throttle = function (...args) {
        return new Promise((resolve, reject) => {
            try {
                // 1.è·å–å½“å‰æ—¶é—´
                const nowTime = new Date().getTime();

                // å¯¹ç«‹å³æ‰§è¡Œè¿›è¡Œæ§åˆ¶
                if (!leading && startTime === 0) {
                    startTime = nowTime;
                }

                // 2.è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´æ‰§è¡Œå‡½æ•°
                const waitTime = interval - (nowTime - startTime);
                if (waitTime <= 0) {
                    // console.log("æ‰§è¡Œæ“ä½œfn")
                    if (timer) clearTimeout(timer);
                    const res = fn.apply(this, args);
                    resolve(res);
                    startTime = nowTime;
                    timer = null;
                    return;
                }

                // 3.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œå°¾éƒ¨
                if (trailing && !timer) {
                    timer = setTimeout(() => {
                        // console.log("æ‰§è¡Œtimer")
                        const res = fn.apply(this, args);
                        resolve(res);
                        startTime = new Date().getTime();
                        timer = null;
                    }, waitTime);
                }
            } catch (error) {
                reject(error);
            }
        });
    };

    _throttle.cancel = function () {
        if (timer) clearTimeout(timer);
        startTime = 0;
        timer = null;
    };

    return _throttle;
}
```



æ³¨é‡Šç‰ˆ : 

```javascript
// å®šä¹‰èŠ‚æµå‡½æ•°
function hythrottle(fn, interval, { leading = true, trailing = false } = {}) {
    let startTime = 0; // è®°å½•ä¸Šæ¬¡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´
    let timer = null;  // è®°å½•å½“å‰çš„å®šæ—¶å™¨

    // è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°ä¼šåœ¨æ¯ä¸ªæŒ‡å®šçš„æ—¶é—´é—´éš”å†…æœ€å¤šåªæ‰§è¡Œä¸€æ¬¡å‡½æ•° fn
    const _throttle = function (...args) {
        // è¿”å›ä¸€ä¸ª Promiseï¼Œä»¥ä¾¿äºå¤„ç†å¼‚æ­¥æ“ä½œ
        return new Promise((resolve, reject) => {
            try {
                const nowTime = new Date().getTime(); // è·å–å½“å‰æ—¶é—´

                // å¦‚æœ leading ä¸º false å¹¶ä¸”æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œé‚£ä¹ˆæ›´æ–° startTime ä¸ºå½“å‰æ—¶é—´
                if (!leading && startTime === 0) {
                    startTime = nowTime;
                }

                const waitTime = interval - (nowTime - startTime); // è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´

                // å¦‚æœéœ€è¦ç­‰å¾…çš„æ—¶é—´å°äºç­‰äº 0ï¼Œé‚£ä¹ˆç«‹å³æ‰§è¡Œå‡½æ•° fn
                if (waitTime <= 0) {
                    if (timer) clearTimeout(timer); // æ¸…é™¤å®šæ—¶å™¨
                    const res = fn.apply(this, args); // æ‰§è¡Œå‡½æ•° fn å¹¶è·å–è¿”å›å€¼
                    resolve(res); // å°†å‡½æ•° fn çš„è¿”å›å€¼ä¼ ç»™ Promise
                    startTime = nowTime; // æ›´æ–°ä¸Šæ¬¡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´
                    timer = null; // æ¸…é™¤å®šæ—¶å™¨
                    return;
                }

                // å¦‚æœ trailing ä¸º true å¹¶ä¸”å½“å‰æ²¡æœ‰å®šæ—¶å™¨ï¼Œé‚£ä¹ˆåœ¨æŒ‡å®šçš„æ—¶é—´åæ‰§è¡Œå‡½æ•° fn
                if (trailing && !timer) {
                    timer = setTimeout(() => {
                        const res = fn.apply(this, args); // æ‰§è¡Œå‡½æ•° fn å¹¶è·å–è¿”å›å€¼
                        resolve(res); // å°†å‡½æ•° fn çš„è¿”å›å€¼ä¼ ç»™ Promise
                        startTime = new Date().getTime(); // æ›´æ–°ä¸Šæ¬¡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´
                        timer = null; // æ¸…é™¤å®šæ—¶å™¨
                    }, waitTime);
                }
            } catch (error) {
                reject(error); // å¦‚æœå‡ºç°é”™è¯¯ï¼Œå°†é”™è¯¯ä¼ ç»™ Promise
            }
        });
    };

    // æ·»åŠ ä¸€ä¸ª cancel æ–¹æ³•ï¼Œç”¨äºå–æ¶ˆèŠ‚æµ
    _throttle.cancel = function () {
        if (timer) clearTimeout(timer); // æ¸…é™¤å®šæ—¶å™¨
        startTime = 0; // é‡ç½®ä¸Šæ¬¡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´
        timer = null; // æ¸…é™¤å®šæ—¶å™¨
    };

    return _throttle; // è¿”å›æ–°å‡½æ•°
}
```

![img](https://cdn.nlark.com/yuque/0/2023/png/29006943/1683275784365-68585f5b-2be1-451a-afb4-df954b14a205.png)